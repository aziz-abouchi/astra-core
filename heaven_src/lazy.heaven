-- lazy.heaven

type Lazy[T] =
  thunk : () -> T
  memo  : Option[T]
  qtt   : QTT

lazy :
  thunk : () -> T
  qtt   : QTT
  -> Lazy[T]

lazy thunk qtt =
  Lazy { thunk = thunk, memo = None, qtt = qtt }

force : l : Lazy[T] -> T
force l when l.memo != None =
  l.memo?

force l =
  let v = l.thunk()
  l.memo = Some v
  v

